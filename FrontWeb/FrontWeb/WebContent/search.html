<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Chef</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/7a52739f2b.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="project.config.js" charset="utf-8"></script>
    <script type="text/javascript" src="commons.js" charset="utf-8"></script>
</head>
<body>
    <nav id="navBar" class="navbar-white">
        <a href="index.html"><img src="images/logo2.png" class="logo"></a>
        <ul class="nav-links">
            <li><a href="index.html" class="simple">홈</a></li>
            <li><a href="listing.html?category=personal">개인용</a></li>
            <li><a href="listing.html?category=entertain">접대용</a></li>
            <li><a href="listing.html?category=nightmeal">야식용</a></li>
        </ul>
        <a href="login.html" class="register-btn" id="loginBtn" onclick="logout()">로그인</a>
        <i class="fas fa-bars" onclick="togglebtn()"></i>
    </nav>

    <div class="container">

        <div class="list-container">
            <div class="left-col" id="left-col">   
            </div>  
        </div>

        <div class="footer">
            <hr>
            <p> Copyright By 2022, 레시피를 부탁해</p>
        </div>

    </div>

    <script>
        let navBar = document.getElementById("navBar")

        const categories = {
            livestock:"축산물",
            seafood:"해산물",
            personal:"개인용",
            entertain:"접대용",
            nightmeal:"야식용"
        }

        let sortOrder = "readcount"
        let bigOptions = ["livestock", "seafood"]
        let checked = [true, true]

        function togglebtn(){
            navBar.classList.toggle("hidemenu");
        }

        function goRecipeDetail(recipeSeq) {
            location.href = "food.html?recipeSeq=" + recipeSeq
        }

        function filterRecipe(data, category){
            $("<h1 id='listHead'>" + categories[category]  + " 검색 결과</h1>").appendTo("#left-col")

            if (data.length == 0) {
                $("<div class='best-img'>" + 
                        "<div class='best-info'><p>검색결과가 없습니다.</p></div>" + 
                    "</div>").appendTo("#left-col");
            }
            else {
                $.each(data, function(index, value){
                    $("<div class='best' onclick='goRecipeDetail(" + value.recipeSeq +")'>" + 
                            "<div class='best-img'>" +
                                "<img src=" + 'images/image-10.jpg' + ">" +	
                            "</div>" +
                            "<div class='best-info'>" + 
                                "<p>" + categories[value.recipeBigCategory] +"</p>" +
                                "<h3>" +  value.recipeTitle + "</h3>" +
                                "<p>평점: " +  value.recipeRating + "</p>" +
                                "<p>조회수: " +  value.recipeReadcount + "</p>" +
                                "<p>" + value.recipeCapacity +"인분</p>" +
                            "</div>" + 
                        "</div>")
                    .appendTo("#left-col");
                });
            }
        }

        $( document ).ready(function() {
            var url = document.URL;
        	let search = decodeURI(url.substring(url.indexOf("recipeSeq")).split("=")[1]);
            
            $.ajax({
	    		url: "http://192.168.0.4:3000/searchRecipe",
	    		    data: {
                        search:search,
	    			    bigOptions:"livestock,seafood",
                        smallOptions:"personal",
                        sortOrder:"readcount"
	    		    },
                    success: function ( result ) {
                        filterRecipe(result, "personal")
                    }
                });

                $.ajax({
	    		url: "http://192.168.0.4:3000/searchRecipe",
	    		    data: {
                        search:search,
	    			    bigOptions:"livestock,seafood",
                        smallOptions:"entertain",
                        sortOrder:"readcount"
	    		    },
                    success: function ( result ) {
                        filterRecipe(result, "entertain")
                    }
                });

                $.ajax({
	    		url: "http://192.168.0.4:3000/searchRecipe",
	    		    data: {
                        search:search,
	    			    bigOptions:"livestock,seafood",
                        smallOptions:"nightmeal",
                        sortOrder:"readcount"
	    		    },
                    success: function ( result ) {
                        filterRecipe(result, "nightmeal")
                    }
                });
        })
    </script>
</body>
</html>